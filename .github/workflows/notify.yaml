# DO NOT EDIT THIS FILE.
# Instead, edit the jsonpatch file (actually YAML) in .github/notify-patch.yaml
# For docs, see github-actions in the IronCoreLabs/depot repo.

name: Notify
'on':
  workflow_run:
    workflows:
    - Bump Version
    - Deploy
    - Docker
    - Rebuild all container images
    - Rust CI
    - Rust Daily
    - Scala CI
    - Scala CVE
    - Scala Daily
    - TypeScript CI
    - Update Workflows
    types:
    - completed
    branches:
    - main
jobs:
  on-failure:
    runs-on: ubuntu-20.04
    if: ${{ github.event.workflow_run.conclusion != 'success' }}
    steps:
    - name: Debug
      run: cat ${{ github.event_path }}
    - name: Post to Slack on failure
      run: "set -x\necho 'Failed a run of <${{ github.event.workflow_run.html_url\
        \ }}|${{ github.event.workflow_run.name }}> in ${{ github.event.repository.name\
        \ }}.' > text.txt\necho \"GitHub Workflow Bot\" > username.txt\necho \":bomb:\"\
        \ > icon_emoji.txt\n# echo \"https://i.chzbgr.com/full/8209966592/h2FE3826C/how-awesome-are-you\"\
        \ > icon_url.txt\necho \"#build-failures\" > channel.txt\necho '{}' | \\\n\
        jq --rawfile text text.txt \\\n  --rawfile username username.txt \\\n  --rawfile\
        \ icon_emoji icon_emoji.txt \\\n  --rawfile channel channel.txt \\\n  '. +\
        \ {\"text\": $text, \"username\": $username, \"icon_emoji\": $icon_emoji,\
        \ \"channel\": $channel}' | \\\ncurl -Ssf -d @- -H \"Content-type: application/json\"\
        \ '${{ secrets.SLACK_BUILD_FAILURE_WEBHOOK }}'\n"
